var titlePage=!0,controlPage=!1,level1=!1,level2=!1,level3=!1,level4=!1,level5=!1,g=ga(512,700,titleSetup,"./assets/virus.png ./assets/noarmor.png ./assets/armor.png ./assets/boss.png ./assets/sword.png ./assets/attack.png ./assets/health.png ./assets/exit.png ./assets/background.png".split(" "));g.canvas.style.border="1px black dashed";g.backgroundColor="white";g.start();
var titleScene,controlScene,missionScene,background,player,enemies,bullets,shield,shieldBar,boss,bossBullets,exit,sword,swordswing,healthBar,bossHealth,message,gameScene,gameOverScene,angleBetween,walls,lastDirection=0,hasSword=!1,hasGun=!1,enemiesNumber=lastDirection=0,numberOfBullets=0,bulletTimer=0,bulletFrequency=60,healed=!1,armorTimer=0,armorOff=300,bossArmor=!0,shieldTimer=0,shieldOff=60,buttonSquare,controlSquare,backButton;
function titleSetup(){titleScene=g.group();background=g.sprite("./assets/background.png");background.scaleX=6.3;background.scaleY=10.5;background.x=215;background.y=310;titleScene.addChild(background);var a=g.text("Invaders","64px Futura","white");a.x=150;a.y=(g.canvas.height-188)/2-64;titleScene.addChild(a);buttonSquare=g.rectangle(100,100,"white","1px black");buttonSquare.x=100;buttonSquare.y=270;a=g.text("Play","32px Futura","black");a.x=120;a.y=300;a=g.group(buttonSquare,a);a.x=20;a.y=25;controlSquare=
g.rectangle(150,100,"white","1px black");controlSquare.x=245;controlSquare.y=295;var b=g.text("Controls","32px Futura","black");b.x=265;b.y=325;controlButton=g.group(controlSquare,b);titleScene.addChild(a);titleScene.addChild(controlButton);createPlayer();g.state=titlePlay}
function titlePlay(){g.move(player);g.contain(player,{x:40,y:40,width:475,height:500});g.hitTestRectangle(player,buttonSquare)?(titlePage=!1,titleScene.visible=!1,level1=!0,g.state=mission):g.hitTestRectangle(player,controlSquare)&&(titlePage=!1,controlPage=!0,titleScene.visible=!1,g.state=controlSetup)}var missionTimer=0,missionTime=300;
function mission(){missionScene=g.group();background=g.sprite("./assets/background.png");background.scaleX=6.3;background.scaleY=10.5;background.x=215;background.y=310;missionScene.addChild(background);var a=g.text("Mission","64px Futura","white",40,20);a.y=50;missionScene.addChild(a);a=g.text("- Invade the Computer","30px Futura","white",20,20);a.x=50;a.y=150;missionScene.addChild(a);a=g.text("- Survive against the defender","30px Futura","white",20,20);a.x=50;a.y=225;missionScene.addChild(a);a=
g.text("- Use different Resources to","30px Futura","white",20,20);a.x=50;a.y=300;missionScene.addChild(a);a=g.text("Combat the Antivirus","30px Futura","white",20,20);a.x=125;a.y=350;missionScene.addChild(a);a=g.text("- SHUT DOWN EVERYTHING!","30px Futura","white",20,20);a.x=50;a.y=425;missionScene.addChild(a);g.state=missionPlay}function missionPlay(){missionTimer++;missionTimer==missionTime&&(missionTimer=0,g.state=setup)}
function controlSetup(){controlScene=g.group();controlScene.addChild(background);var a=g.rectangle(75,50,"white","1px black dashed"),b=g.text("Back","16px Futura","Black",20,15);backButton=g.group(a,b);backButton.x=400;backButton.y=432;controlScene.addChild(backButton);a=g.text("Controls","64px Futura","white");a.x=40;a.y=30;controlScene.addChild(a);a=g.text("Up Arrow - Move Up","24px Futura","white");a.y=115;a.x=40;b=g.text("Down Arrow - Move Down","24px Futura","white");b.y=165;b.x=40;var d=g.text("Left Arrow - Move Left",
"24px Futura","white");d.y=215;d.x=40;var e=g.text("Right Arrow - Move Right","24px Futura","white");e.y=265;e.x=40;var c=g.text("Space Button - Melee Attack (Locked)","24px Futura","white");c.y=315;c.x=40;var k=g.text("W Button -  Shoot Gun (Locked)","24px Futura","white");k.y=365;k.x=40;var h=g.text("Q Button - Shield On (Locked)","24px Futura","white");h.y=415;h.x=40;a=g.group(a,b,d,e,c,k,h);controlScene.addChild(a);a.x=25;createPlayer();g.state=controlPlay}
function controlPlay(){g.move(player);g.contain(player,{x:40,y:40,width:475,height:500});g.hitTestRectangle(player,backButton)&&(titlePage=!0,controlPage=!1,controlScene.visible=!1,g.state=titleSetup)}
function createEnemies(a,b){enemiesNumber=0;var d=48,e=150,c=2,k=1;level2&&(c=5);if(level4||level5)d=50,e=75,c=3,level5&&(c=5);enemies=[];for(var h=0;h<a;h++){var f=g.sprite("./assets/noarmor.png"),l=g.randomInt(0,g.canvas.height-188-f.height),m=d*h+e;f.x=l;f.y=m;f.scaleX=4;f.scaleY=4;f.vx=c*k;f.id=h;f.armor=!1;k*=-1;enemies.push(f);enemiesNumber++;gameScene.addChild(f)}for(h=0;h<b;h++)f=g.sprite("./assets/armor.png"),l=g.randomInt(0,g.canvas.height-188-f.height),m=d*h+ +e,f.x=l,f.y=m,f.scaleX=4,
f.scaleY=4,f.vx=c*k+1,f.id=h+a,f.armor=!0,k*=-1,enemies.push(f),enemiesNumber++,gameScene.addChild(f)}function createHealthBar(){var a=g.rectangle(128,16,"black"),b=g.rectangle(128,16,"yellowGreen");healthBar=g.group(a,b);healthBar.inner=b;healthBar.x=g.canvas.width-148;healthBar.y=20;gameScene.addChild(healthBar)}
function createShieldBar(){var a=g.rectangle(128,16,"black"),b=g.rectangle(128,16,"yellow");shieldBar=g.group(a,b);shieldBar.inner=b;shieldBar.x=g.canvas.width-148;shieldBar.y=50;gameScene.addChild(shieldBar)}
function createPlayer(){titlePage||controlPage?(player=g.sprite("./assets/virus.png"),player.scaleX=2.5,player.scaleY=2.5,player.x=g.canvas.width/2-player.halfWidth,player.y=g.canvas.height-233,titlePage?titleScene.addChild(player):controlScene.addChild(player)):(player.x=g.canvas.width/2-player.halfWidth,player.y=g.canvas.height-233,player.shield=!1,gameScene.addChild(player));g.key.leftArrow.press=function(){player.vx=-5;lastDirection=1;g.key.upArrow.isDown&&(player.vy=-5);g.key.downArrow.isDown&&
(player.vy=5)};g.key.leftArrow.release=function(){g.key.rightArrow.isDown||(player.vx=0)};g.key.rightArrow.press=function(){player.vx=5;lastDirection=2;g.key.upArrow.isDown&&(player.vy=-5);g.key.downArrow.isDown&&(player.vy=5)};g.key.rightArrow.release=function(){g.key.leftArrow.isDown||(player.vx=0)};g.key.upArrow.press=function(){player.vy=-5;lastDirection=3;g.key.rightArrow.isDown&&(player.vx=5);g.key.leftArrow.isDown&&(player.vx=-5)};g.key.upArrow.release=function(){g.key.downArrow.isDown||(player.vy=
0)};g.key.downArrow.press=function(){player.vy=5;lastDirection=4;g.key.rightArrow.isDown&&(player.vx=5);g.key.leftArrow.isDown&&(player.vx=-5)};g.key.downArrow.release=function(){g.key.upArrow.isDown||(player.vy=0)}}
function setup(){gameScene=g.group();level1&&(background=g.sprite("./assets/background.png"),background.scaleX=6.3,background.scaleY=10.5,background.x=215,background.y=310,gameScene.addChild(background));exit=g.sprite("./assets/exit.png");exit.scaleX=4;exit.scaleY=4;exit.x=50;exit.y=50;gameScene.addChild(exit);level1?(createPlayer(),createHealthBar()):(player.x=g.canvas.width/2-player.halfWidth,player.y=g.canvas.height-233);hasSword&&(swordswing.visible=!1,swordswing.x=player.x-16,swordswing.y=player.y-
16);(level1||level2)&&createEnemies(6,0);level3&&(hasGun=!0,g.remove(healthPotion),createEnemies(6,6),bullets=[],angleToShoot=1==lastDirection?3.14:2==lastDirection?0:3==lastDirection?4.71:4==lastDirection?1.57:4.71,g.keyboard(87).press=function(){hasGun&&g.shoot(player,angleToShoot,16,7,bullets,function(){bullet=g.rectangle(5,5,"black");bullet.vy=7;bullet.id=numberOfBullets;numberOfBullets++;gameScene.addChild(bullet);return bullet})});if(level4||level5){createEnemies(0,8);level4&&(createShieldBar(),
shield=g.circle(32,"yellow"),shield.alpha=.5);shield.x=player.x-10;shield.y=player.y-10;shield.visible=!1;gameScene.addChild(shield);walls=[];var a=g.rectangle(400,10,"black");a.x=0;a.y=410;a.id="left";walls.push(a);gameScene.addChild(a);a=g.rectangle(412,10,"black");a.x=200;a.y=310;a.id="right";walls.push(a);gameScene.addChild(a);a=g.rectangle(50,10,"black");a.x=0;a.y=310;a.id="left";walls.push(a);gameScene.addChild(a);a=g.rectangle(250,10,"black");a.x=0;a.y=210;a.id="left";walls.push(a);gameScene.addChild(a);
a=g.rectangle(92,10,"black");a.x=420;a.y=210;a.id="right";walls.push(a);gameScene.addChild(a);a=g.rectangle(150,10,"black");a.x=0;a.y=110;a.id="left";walls.push(a);gameScene.addChild(a);a=g.rectangle(212,10,"black");a.x=300;a.y=110;a.id="right";walls.push(a);gameScene.addChild(a);level5&&g.remove(healthPotion)}message=g.text("Game Over!","64px Futura","black",20,20);message.x=120;message.y=(g.canvas.height-188)/2-64;gameOverScene=g.group();background=g.sprite("./assets/background.png");background.scaleX=
6.3;background.scaleY=10.5;background.x=215;background.y=310;gameOverScene.addChild(background);gameOverScene.addChild(message);gameOverScene.visible=!1;g.state=play}
function play(){var a=!1;g.move(player);g.contain(player,{x:40,y:40,width:475,height:500});hasSword&&(1==lastDirection?(angleToShoot=3.14,swordswing.x=player.x-32,swordswing.y=player.y):2==lastDirection?(angleToShoot=0,swordswing.x=player.x+32,swordswing.y=player.y):3==lastDirection?(angleToShoot=4.71,swordswing.y=player.y-32,swordswing.x=player.x):4==lastDirection?(angleToShoot=1.57,swordswing.y=player.y+32,swordswing.x=player.x):(angleToShoot=4.71,swordswing.x=player.x-16,swordswing.y=player.y-
16),g.key.space.press=function(){swordswing.visible=!0;enemies.filter(function(a){if(g.hitTestCircleRectangle(swordswing,a)){a=a.id;for(var b=0;b<enemiesNumber;b++)enemies[b].id==a&&(g.remove(enemies[b]),enemies.splice(b,1),--enemiesNumber)}})},g.key.space.release=function(){swordswing.visible=!1});if(level3||level4||level5)if(g.move(bullets),enemies.filter(function(a){bullets.filter(function(b){if(g.hitTestRectangle(b,a)){var e=a.id;b=b.id;if(0==a.armor){for(var c=0;c<enemiesNumber;c++)enemies[c].id==
e&&(g.remove(enemies[c]),enemies.splice(c,1),--enemiesNumber);e=0}else{for(c=0;c<enemiesNumber;c++)if(enemies[c].id==e){enemies[c].armor=!1;var d=g.sprite("./assets/noarmor.png");d.x=enemies[c].x;d.y=enemies[c].y;d.vx=enemies[c].vx;d.armor=!1;d.id=enemies[c].id;d.direction=enemies[c].direction;var h=enemies[c];enemies[c]=d;gameScene.addChild(d);g.remove(h)}e=0}for(;e<numberOfBullets;e++)bullets[e].id==b&&(g.remove(bullets[e]),bullets.splice(e,1),--numberOfBullets)}})}),level4||level5)shield.x=player.x-
10,shield.y=player.y-10,g.keyboard(81).press=function(){shield.visible=!0;player.shield=!0},g.keyboard(81).release=function(){shield.visible=!1;player.shield=!1},1==player.shield&&shieldTimer++,1==player.shield&&shieldTimer!=shieldOff?0<shieldBar.inner.width&&(shieldBar.inner.width-=128/shieldOff):shieldTimer=0,0==player.shield&&128>shieldBar.inner.width&&(shieldBar.inner.width+=128/shieldOff),0==shieldBar.inner.width&&(shield.visible=!1,player.shield=!1),walls.filter(function(b){g.rectangleCollision(player,
b);level5&&(void 0!=g.rectangleCollision(player,b)&&(a=!0),bullets.filter(function(a){if(g.hitTestRectangle(a,b)){a=a.id;for(var e=0;e<numberOfBullets;e++)bullets[e].id==a&&(g.remove(bullets[e]),bullets.splice(e,1),--numberOfBullets)}}))});enemies.forEach(function(b){g.move(b);var d=g.contain(b,{x:40,y:40,width:475,height:500});if("left"===d||"right"===d)b.vx*=-1;g.hitTestRectangle(player,b)&&0==player.shield&&(a=!0)});a?(player.alpha=.5,--healthBar.inner.width):player.alpha=1;0>healthBar.inner.width&&
(g.state=end,message.content="You lost!");g.hitTestCircleRectangle(player,exit)&&(g.state=bossSetup)}
function bossSetup(){enemies.forEach(function(a){gameScene.removeChild(a)});level1&&(sword=g.sprite("./assets/sword.png"),sword.x=g.canvas.width-20-sword.width-20,sword.y=g.canvas.height-188-sword.height-30,sword.scaleX=2,sword.scaleY=2,gameScene.addChild(sword));swordswing=g.sprite("./assets/attack.png");swordswing.visible=!1;swordswing.scaleX=8;swordswing.scaleY=8;boss=g.sprite("./assets/boss.png");boss.x=g.canvas.width/2-boss.halfWidth;boss.y=(g.canvas.height-188)/2-boss.halfWidth;boss.scaleX=
4;boss.scaleY=4;boss.dead=!1;gameScene.addChild(boss);if(level1||level2){var a=g.rectangle(128,16,"black"),b=g.rectangle(128,16,"yellowGreen");bossHealth=g.group(a,b);bossHealth.inner=b;bossHealth.x=g.canvas.width-375;bossHealth.y=20}else{a=g.rectangle(128,16,"black");b=g.rectangle(128,16,"yellowGreen");var d=g.rectangle(128,16,"yellow");bossHealth=g.group(a,b,d);bossHealth.inner=b;bossHealth.armor=d;bossHealth.x=g.canvas.width-350;bossHealth.y=30}gameScene.addChild(bossHealth);if(level2||level4)healthPotion=
g.sprite("./assets/health.png"),healthPotion.x=g.canvas.width-healthPotion.width-60,healthPotion.y=g.canvas.height-188-healthPotion.height-30,healthPotion.scaleX=4,healthPotion.scaleY=4,gameScene.addChild(healthPotion);(level4||level5)&&walls.forEach(function(a){gameScene.removeChild(a)});bulletTimer=0;bossBullets=[];player.x=g.canvas.width/2-player.halfWidth;player.y=g.canvas.height-188-player.height-45;healed=!1;g.state=bossPlay}
function bossPlay(){var a=!1;g.move(player);g.move(boss);g.contain(player,{x:40,y:40,width:475,height:500});var b=g.contain(boss,{x:10,y:23,width:498,height:492});if("left"===b||"right"===b||"top"===b||"bottom"===b){var d=b=0;b=Math.floor(11*Math.random())+-5;d=Math.floor(11*Math.random())+-5;boss.vx=b;boss.vy=d}if(hasSword||g.hitTestRectangle(player,sword))hasSword=!0,sword.visible=!1,1==lastDirection?(angleToShoot=3.14,swordswing.x=player.x-32,swordswing.y=player.y):2==lastDirection?(angleToShoot=
0,swordswing.x=player.x+32,swordswing.y=player.y):3==lastDirection?(angleToShoot=4.71,swordswing.y=player.y-32,swordswing.x=player.x):4==lastDirection?(angleToShoot=1.57,swordswing.y=player.y+32,swordswing.x=player.x):(angleToShoot=4.71,swordswing.x=player.x-16,swordswing.y=player.y-16);g.key.space.press=function(){1==hasSword&&(swordswing.visible=!0);g.hitTestCircleRectangle(swordswing,boss)&&(level3?0==bossArmor&&(bossHealth.inner.width-=5):bossHealth.inner.width-=5)};g.key.space.release=function(){swordswing.visible=
!1};if(level2||level3||level4||level5){(level2||level4)&&g.hitTestRectangle(player,healthPotion)&&!healed&&(128<healthBar.inner.width+25&&153>healthBar.inner.width+25&&(healthBar.inner.width=128,healed=!0,healthPotion.visible=!1),128>healthBar.inner.width+25&&(healthBar.inner.width+=25,healed=!0,healthPotion.visible=!1));angleBetween=Math.atan2(boss.y-player.y,boss.x-player.x)-Math.PI;bulletTimer++;boss.dead||(bulletTimer==bulletFrequency&&(g.shoot(boss,angleBetween,0,5,bossBullets,function(){bullet=
g.rectangle(10,10,"black");gameScene.addChild(bullet);return bullet}),bulletTimer=0),bossBullets.filter(function(b){return g.hitTestRectangle(player,b)&&0==player.shield?a=!0:!1}));if(level3||level4||level5)bullets.filter(function(a){if(g.hitTestRectangle(boss,a)&&0==boss.dead){a=a.id;(level3||level4)&&0==bossArmor&&(bossHealth.inner.width-=5);for(var b=0;b<numberOfBullets;b++)bullets[b].id==a&&(g.remove(bullets[b]),bullets.splice(b,1),numberOfBullets--,bossArmor=bossHealth.armor.visible=!1)}}),g.move(bullets),
level4&&(shield.x=player.x-10,shield.y=player.y-10,g.keyboard(81).press=function(){shield.visible=!0;player.shield=!0},g.keyboard(81).release=function(){shield.visible=!1;player.shield=!1},1==player.shield&&shieldTimer++,1==player.shield&&shieldTimer!=shieldOff?0<shieldBar.inner.width&&(shieldBar.inner.width-=2):shieldTimer=0,0==player.shield&&120>shieldBar.inner.width&&(shieldBar.inner.width+=2),0==shieldBar.inner.width&&(shield.visible=!1,player.shield=!1));g.move(bossBullets);0==bossArmor&&(g.key.space.press=
function(){swordswing.visible=!0;g.hitTestCircleRectangle(swordswing,boss)&&0==bossArmor&&(bossHealth.inner.width-=5)},g.key.space.release=function(){swordswing.visible=!1},armorTimer++);armorTimer==armorOff&&(armorTimer=0,bossArmor=!0,bossHealth.armor.visible=!0)}g.hitTestRectangle(boss,player)&&!boss.dead&&0==player.shield&&(a=!0);a?(player.alpha=.5,--healthBar.inner.width):player.alpha=1;0>healthBar.inner.width&&(g.state=end,message.content="You lost!");0>bossHealth.inner.width&&!boss.dead&&(g.remove(boss),
g.remove(bossHealth),boss.dead=!0);g.hitTestCircleRectangle(player,exit)&&boss.dead&&(level1?(level1=!1,level2=!0,g.state=setup):level2?(bossBullets.forEach(function(a){gameScene.removeChild(a)}),level2=!1,level3=!0,g.state=setup):level3?(level3=!1,level4=!0,g.state=setup):level4?(level4=!1,level5=!0,g.state=setup):(level4&&(level5=!1,message.content="You Win!"),g.state=end))}
function end(){gameScene.visible=!1;titleScene.visible=!1;missionScene.visible=!1;gameOverScene.visible=!0;missionTimer++;missionTimer==missionTime&&(titlePage=!0,hasGun=hasSword=level5=level4=level3=level2=level1=controlPage=!1,missionTimer=0,g.state=titleSetup)};